
generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}



enum UserRole {
  USER
  ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  EMAIL_VERIFIED
  PHONE_VERIFIED
}

enum TokenType {
  password_reset
  email_verify
  phone_verify
}

model User {
  // Basic Identification
  id          String  @id @default(uuid()) @db.Uuid
  firstName   String? @db.VarChar(40)
  lastName    String? @db.VarChar(40)
  middleName  String? @db.VarChar(40)
  displayName String? @db.VarChar(100)

  email            String  @unique
  emailVerified    Boolean @default(false)
  phoneCountryCode String
  phoneNumber      String  @unique
  phoneVerified    Boolean @default(false)
  password         String

  // Account Management
  type        UserRole   @default(USER)
  status      UserStatus @default(ACTIVE)
  avatar      String?
  dateOfBirth DateTime?
  gender      String?    @db.VarChar(20)

  // Marketing & Communication Preferences
  acceptsMarketing     Boolean @default(false)
  newsletterSubscribed Boolean @default(false)
  emailNotifications   Boolean @default(true)
  smsNotifications     Boolean @default(false)

  // Timestamps
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  lastLoginAt       DateTime?
  passwordUpdatedAt DateTime?

  // relations
  userTokens UserToken[]

  // Indexes
  @@index([phoneCountryCode, phoneNumber], name: "user_phone_country_code_phone_number_idx")
  @@index([email], name: "user_email_idx")
  @@index([status], name: "user_status_idx")
  @@index([createdAt], name: "user_created_at_idx")
}

model UserToken {
  id        String    @id @default(uuid()) @db.Uuid
  type      TokenType
  token     String
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  userId    String    @db.Uuid

  @@index([type, userId], name: "idx_user_token")
}

model RefreshTokenBlacklist {
  id        String   @id @default(uuid()) @db.Uuid
  reference String   @unique @db.VarChar(255)
  expiresAt DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
